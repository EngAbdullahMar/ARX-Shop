<!DOCTYPE html>

<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<!-- Primary Meta Tags -->
<title>ARX-Shop - منصة البيع والشراء الآمن | متجر إلكتروني موثوق</title>
<meta content="ARX-Shop - منصة البيع والشراء الآمن | متجر إلكتروني موثوق" name="title"/>
<meta content="ARX-Shop هي منصة التجارة الإلكترونية الرائدة في المنطقة العربية. بع واشتري بأمان - ملابس، إلكترونيات، أثاث، تجميل وآلاف المنتجات الأخرى. انضم لآلاف المستخدمين الراضين." name="description"/>
<meta content="متجر إلكتروني, بيع وشراء, تسوق أونلاين, منتجات عربية, ملابس, إلكترونيات, أثاث, تجميل, ARX-Shop, تجارة إلكترونية, سوق إلكتروني" name="keywords"/>
<meta content="ARX-Shop Team" name="author"/>
<meta content="index, follow" name="robots"/>
<meta content="Arabic" name="language"/>
<meta content="7 days" name="revisit-after"/>
<!-- Accessibility Meta Tags -->
<meta content="light dark" name="color-scheme"/>
<meta content="light dark" name="supported-color-schemes"/>
<!-- Open Graph / Facebook -->
<meta content="website" property="og:type"/>
<meta content="https://arx-shop.com/" property="og:url"/>
<meta content="ARX-Shop - منصة البيع والشراء الآمن" property="og:title"/>
<meta content="منصة التجارة الإلكترونية الرائدة في المنطقة العربية. بع واشتري بأمان - آلاف المنتجات في انتظارك!" property="og:description"/>
<meta content="https://arx-shop.com/images/og-image.jpg" property="og:image"/>
<meta content="1200" property="og:image:width"/>
<meta content="630" property="og:image:height"/>
<meta content="ARX-Shop" property="og:site_name"/>
<meta content="ar_SA" property="og:locale"/>
<!-- Twitter -->
<meta content="summary_large_image" property="twitter:card"/>
<meta content="https://arx-shop.com/" property="twitter:url"/>
<meta content="ARX-Shop - منصة البيع والشراء الآمن" property="twitter:title"/>
<meta content="منصة التجارة الإلكترونية الرائدة في المنطقة العربية. بع واشتري بأمان!" property="twitter:description"/>
<meta content="https://arx-shop.com/images/twitter-image.jpg" property="twitter:image"/>
<meta content="@ARXShop" property="twitter:site"/>
<meta content="@ARXShop" property="twitter:creator"/>
<!-- Additional Meta Tags -->
<meta content="#667eea" name="theme-color"/>
<meta content="#667eea" name="msapplication-TileColor"/>
<meta content="yes" name="apple-mobile-web-app-capable"/>
<meta content="default" name="apple-mobile-web-app-status-bar-style"/>
<meta content="ARX-Shop" name="apple-mobile-web-app-title"/>
<!-- Canonical URL -->
<link href="https://arx-shop.com/" rel="canonical"/>
<!-- Favicon -->
<link href="/favicon.ico" rel="icon" type="image/x-icon"/>
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"/>
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/>
<link href="/site.webmanifest" rel="manifest"/>
<!-- Preconnect for performance -->
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://cdn.tailwindcss.com" rel="preconnect"/>
<!-- DNS Prefetch -->
<link href="//fonts.googleapis.com" rel="dns-prefetch"/>
<link href="//fonts.gstatic.com" rel="dns-prefetch"/>
<!-- Fonts with display=swap for better performance -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&amp;display=swap" rel="stylesheet"/>
<!-- Structured Data - Organization -->
<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "ARX-Shop",
        "url": "https://arx-shop.com",
        "logo": "https://arx-shop.com/images/logo.png",
        "description": "منصة التجارة الإلكترونية الرائدة في المنطقة العربية",
        "foundingDate": "2024",
        "contactPoint": {
            "@type": "ContactPoint",
            "telephone": "+966-XXX-XXXX",
            "contactType": "customer service",
            "availableLanguage": ["Arabic", "English"]
        },
        "sameAs": [
            "https://twitter.com/ARXShop",
            "https://facebook.com/ARXShop",
            "https://instagram.com/ARXShop"
        ]
    }
    </script>
<!-- Structured Data - WebSite -->
<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "ARX-Shop",
        "url": "https://arx-shop.com",
        "description": "منصة البيع والشراء الآمن - متجر إلكتروني موثوق",
        "inLanguage": "ar",
        "potentialAction": {
            "@type": "SearchAction",
            "target": "https://arx-shop.com/search?q={search_term_string}",
            "query-input": "required name=search_term_string"
        }
    }
    </script>
<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<style>
        /* Accessibility Styles */
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #22c55e;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --bg-primary: #ffffff;
            --bg-secondary: #f9fafb;
            --border-color: #d1d5db;
            --focus-color: #667eea;
            --focus-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            :root {
                --text-primary: #f9fafb;
                --text-secondary: #d1d5db;
                --bg-primary: #1f2937;
                --bg-secondary: #111827;
                --border-color: #374151;
            }
        }
        
        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --primary-color: #000080;
                --text-primary: #000000;
                --bg-primary: #ffffff;
                --border-color: #000000;
                --focus-shadow: 0 0 0 4px #000080;
            }
        }
        
        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }
        
        body {
            font-family: 'Cairo', sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: var(--bg-secondary);
        }
        
        /* Focus management */
        *:focus {
            outline: 2px solid var(--focus-color);
            outline-offset: 2px;
        }
        
        .focus-visible:focus {
            box-shadow: var(--focus-shadow);
        }
        
        /* Skip to content link */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--primary-color);
            color: white;
            padding: 8px;
            text-decoration: none;
            border-radius: 4px;
            z-index: 9999;
            font-weight: bold;
        }
        
        .skip-link:focus {
            top: 6px;
        }
        
        /* Screen reader only content */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* High contrast borders */
        .form-input, .form-select, .form-textarea {
            border: 2px solid var(--border-color);
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: var(--focus-color);
            box-shadow: var(--focus-shadow);
        }
        
        /* Button accessibility */
        .btn {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-height: 44px;
            min-width: 44px;
            padding: 12px 24px;
            border: 2px solid transparent;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn:focus {
            box-shadow: var(--focus-shadow);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        /* Link accessibility */
        a {
            color: var(--primary-color);
            text-decoration: underline;
        }
        
        a:hover, a:focus {
            text-decoration: none;
            background-color: rgba(102, 126, 234, 0.1);
            padding: 2px 4px;
            border-radius: 4px;
        }
        
        /* Error states */
        .error {
            border-color: var(--error-color) !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.3) !important;
        }
        
        .error-message {
            color: var(--error-color);
            font-size: 0.875rem;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        /* Loading states */
        .loading {
            position: relative;
            pointer-events: none;
        }
        
        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* Keyboard navigation indicators */
        .keyboard-user *:focus {
            outline: 3px solid var(--focus-color);
            outline-offset: 2px;
        }
        
        /* Text size adjustments */
        @media (min-width: 768px) {
            body {
                font-size: 16px;
            }
        }
        
        @media (max-width: 767px) {
            body {
                font-size: 18px;
            }
        }
        
        /* Touch target sizes */
        @media (max-width: 768px) {
            .btn, button, input, select, textarea {
                min-height: 48px;
                min-width: 48px;
            }
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        .floating-hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
        
        .heart {
            position: absolute;
            color: #ff6b6b;
            font-size: 20px;
            animation: floatUp 3s ease-out forwards;
        }
        
        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) rotate(360deg);
            }
        }
        
        .pulse-ring {
            animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        
        @keyframes pulse-ring {
            0% {
                transform: scale(0.33);
            }
            80%, 100% {
                opacity: 0;
            }
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: translateX(400px);
            transition: transform 0.5s ease;
            z-index: 1001;
            max-width: 300px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ffd700;
            border-radius: 50%;
            animation: sparkle 1.5s ease-in-out infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }
        
        .typing-indicator {
            display: inline-block;
        }
        
        .typing-indicator::after {
            content: '|';
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .product-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .glow-effect {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(102, 126, 234, 0.5); }
            to { box-shadow: 0 0 30px rgba(102, 126, 234, 0.8); }
        }
        
        /* Loading Spinner Styles */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-dots {
            display: inline-block;
        }
        
        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
        
        .btn-loading {
            position: relative;
            pointer-events: none;
            opacity: 0.8;
        }
        
        .btn-loading .btn-text {
            opacity: 0;
        }
        
        .btn-loading .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .pulse-loading {
            animation: pulse-loading 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse-loading {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .skeleton-loading {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
        }
        
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Performance optimizations */
        .card-hover {
            will-change: transform;
            backface-visibility: hidden;
            perspective: 1000px;
        }
        
        .fade-in {
            will-change: opacity, transform;
        }
        
        .slide-in {
            will-change: transform;
        }
        
        /* Reduce repaints */
        .gradient-bg {
            background-attachment: fixed;
        }
        
        /* Optimize animations */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* GPU acceleration for smooth scrolling */
        #productsGrid {
            transform: translateZ(0);
        }

        .auth-tab {
            transition: all 0.3s ease;
        }
        
        .auth-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .form-slide {
            transition: transform 0.5s ease, opacity 0.5s ease;
        }
        
        .form-slide.hidden {
            transform: translateX(100%);
            opacity: 0;
        }
    </style>
<!-- Firebase SDK -->

<script>
</script>
<script type="module">import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyADRmQy8Cvr3mBUgMqHTVqwkRPoKeR4vSM",
    authDomain: "arx-shop.firebaseapp.com",
    projectId: "arx-shop",
    storageBucket: "arx-shop.firebasestorage.app",
    messagingSenderId: "673855805204",
    appId: "1:673855805204:web:d4838487a6c2bf17265401"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  window.db = db;

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-storage.js";


 
  window.firebase = { auth, db, storage, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, collection, addDoc, getDocs, query, orderBy, ref, uploadBytes, getDownloadURL };

import { collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

  // Load and display products from Firestore
  async function loadProducts() {
    const productsGrid = document.getElementById("productsGrid");
    const noProducts = document.getElementById("noProducts");
    const productCount = document.getElementById("productCount");
    const totalProducts = document.getElementById("totalProducts");
    const todayProducts = document.getElementById("todayProducts");

    try {
      const querySnapshot = await getDocs(collection(window.db, "products"));
      let count = 0;
      productsGrid.innerHTML = "";
      const todayDate = new Date().toISOString().split("T")[0];

      querySnapshot.forEach((doc) => {
        const product = doc.data();
        count++;
        const div = document.createElement("div");
        div.className = "bg-white rounded-xl shadow-md p-4 card-hover";
        div.innerHTML = `
          <img src="${product.images?.[0] || ''}" alt="صورة المنتج" class="w-full h-48 object-cover rounded-lg mb-4">
          <h3 class="text-lg font-bold mb-1">${product.name}</h3>
          <p class="text-sm text-gray-600 mb-2">${product.description}</p>
          <p class="text-base font-semibold text-green-600 mb-2">${product.price} ${product.currency}</p>
          <span class="inline-block bg-blue-100 text-blue-700 text-xs px-2 py-1 rounded">${product.category}</span>
        `;
        productsGrid.appendChild(div);
      });

      noProducts.classList.toggle("hidden", count > 0);
      productCount.textContent = count;
      totalProducts.textContent = count;
      todayProducts.textContent = count;
    } catch (error) {
      console.error("Error loading products:", error);
    }
  }

  // Set up form submission to add a new product to Firestore
  function setupSellForm() {
    const sellForm = document.getElementById("sellForm");
    if (!sellForm) return;

    sellForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const publishBtn = document.getElementById("publishBtn");
      publishBtn.disabled = true;
      const btnText = publishBtn.querySelector(".btn-text");
      btnText.textContent = "جاري النشر...";

      const product = {
        name: document.getElementById("productName").value,
        category: document.getElementById("productCategory").value,
        description: document.getElementById("productDescription").value,
        price: document.getElementById("productPrice").value,
        currency: document.getElementById("productCurrency").value,
        images: [], // TODO: handle image uploads to Storage
        datePosted: new Date().toISOString().split("T")[0]
      };

      try {
        await addDoc(collection(window.db, "products"), product);
        alert("✅ تم نشر المنتج بنجاح!");
        sellForm.reset();
        loadProducts();
        document.getElementById("productsBtn").click();
      } catch (error) {
        alert("❌ فشل في حفظ المنتج: " + error.message);
      } finally {
        publishBtn.disabled = false;
        btnText.textContent = "نشر المنتج";
      }
    });
  }

  // Initialize on DOMContentLoaded
  document.addEventListener("DOMContentLoaded", () => {
    loadProducts();
    setupSellForm();
  });</script></head>
<body class="bg-gray-50 min-h-screen">
<!-- Skip to content link for screen readers -->
<a class="skip-link" href="#main-content">تخطي إلى المحتوى الرئيسي</a>
<!-- Authentication Page -->
<div class="min-h-screen gradient-bg flex items-center justify-center p-4" id="authPage">
<div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in">
<div class="text-center mb-8">
<div aria-label="شعار ARX-Shop" class="w-20 h-20 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full mx-auto mb-4 flex items-center justify-center" role="img">
<span aria-hidden="true" class="text-white text-2xl font-bold">🛒</span>
</div>
<h1 class="text-3xl font-bold text-gray-800 mb-2">ARX-Shop</h1>
<p class="text-gray-600">منصتك المثالية للبيع والشراء</p>
</div>
<!-- Auth Tabs -->
<div aria-label="خيارات تسجيل الدخول" class="flex mb-6 bg-gray-100 rounded-lg p-1" role="tablist">
<button aria-controls="loginFormContainer" aria-selected="true" class="auth-tab flex-1 py-3 px-4 rounded-md text-center font-medium transition-all active btn" id="loginTab" onclick="showLoginForm()" role="tab">
                    تسجيل الدخول
                </button>
<button aria-controls="registerFormContainer" aria-selected="false" class="auth-tab flex-1 py-3 px-4 rounded-md text-center font-medium transition-all text-gray-600 btn" id="registerTab" onclick="showRegisterForm()" role="tab">
                    إنشاء حساب جديد
                </button>
</div>
<!-- Login Form -->
<div aria-labelledby="loginTab" class="form-slide" id="loginFormContainer" role="tabpanel">
<form class="space-y-6" id="loginForm" novalidate="">
<div>
<label class="block text-gray-700 font-semibold mb-2" for="loginEmail">البريد الإلكتروني <span aria-label="حقل مطلوب" class="text-red-500">*</span></label>
<input aria-describedby="loginEmailError" autocomplete="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all form-input" id="loginEmail" name="email" placeholder="example@gmail.com" required="" type="email"/>
<div aria-live="polite" class="error-message" id="loginEmailError" role="alert" style="display: none;"></div>
</div>
<div>
<label class="block text-gray-700 font-semibold mb-2" for="loginPassword">كلمة المرور <span aria-label="حقل مطلوب" class="text-red-500">*</span></label>
<input aria-describedby="loginPasswordError" autocomplete="current-password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent form-input" id="loginPassword" name="password" placeholder="أدخل كلمة المرور" required="" type="password"/>
<div aria-live="polite" class="error-message" id="loginPasswordError" role="alert" style="display: none;"></div>
</div>
<button aria-describedby="loginStatus" class="w-full bg-gradient-to-r from-purple-500 to-blue-500 text-white py-3 rounded-lg font-semibold hover:from-purple-600 hover:to-blue-600 transform hover:scale-105 transition-all duration-200 btn" id="loginBtn" type="submit">
<span class="btn-text">تسجيل الدخول</span>
<div aria-hidden="true" class="loading-overlay" style="display: none;">
<div class="loading-spinner"></div>
<span>جاري تسجيل الدخول<span class="loading-dots"></span></span>
</div>
</button>
<div aria-atomic="true" aria-live="polite" class="sr-only" id="loginStatus"></div>
</form>
</div>
<!-- Register Form -->
<div aria-labelledby="registerTab" class="form-slide hidden" id="registerFormContainer" role="tabpanel">
<form class="space-y-6" id="registerForm" novalidate="">
<div>
<label class="block text-gray-700 font-semibold mb-2" for="registerName">الاسم الكامل <span aria-label="حقل مطلوب" class="text-red-500">*</span></label>
<input aria-describedby="registerNameError" autocomplete="name" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all form-input" id="registerName" name="name" placeholder="أدخل اسمك الكامل" required="" type="text"/>
<div aria-live="polite" class="error-message" id="registerNameError" role="alert" style="display: none;"></div>
</div>
<div>
<label class="block text-gray-700 font-semibold mb-2" for="registerPhone">رقم الهاتف <span aria-label="حقل مطلوب" class="text-red-500">*</span></label>
<div class="flex gap-2">
<label class="sr-only" for="registerCountryCode">رمز الدولة</label>
<select aria-label="اختر رمز الدولة" class="px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 form-select" id="registerCountryCode" name="countryCode">
<option value="+966">🇸🇦 السعودية +966</option>
<option value="+971">🇦🇪 الإمارات +971</option>
<option value="+965">🇰🇼 الكويت +965</option>
<option value="+974">🇶🇦 قطر +974</option>
<option value="+973">🇧🇭 البحرين +973</option>
<option value="+968">🇴🇲 عمان +968</option>
<option value="+962">🇯🇴 الأردن +962</option>
<option value="+961">🇱🇧 لبنان +961</option>
<option value="+963">🇸🇾 سوريا +963</option>
<option value="+20">🇪🇬 مصر +20</option>
</select>
<input aria-describedby="registerPhoneError" autocomplete="tel" class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent form-input" id="registerPhone" name="phone" placeholder="رقم الهاتف" required="" type="tel"/>
</div>
<div aria-live="polite" class="error-message" id="registerPhoneError" role="alert" style="display: none;"></div>
</div>
<div>
<label class="block text-gray-700 font-semibold mb-2" for="registerEmail">البريد الإلكتروني <span aria-label="حقل مطلوب" class="text-red-500">*</span></label>
<input aria-describedby="registerEmailError" autocomplete="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent form-input" id="registerEmail" name="email" placeholder="example@gmail.com" required="" type="email"/>
<div aria-live="polite" class="error-message" id="registerEmailError" role="alert" style="display: none;"></div>
</div>
<div>
<label class="block text-gray-700 font-semibold mb-2" for="registerPassword">كلمة المرور <span aria-label="حقل مطلوب" class="text-red-500">*</span></label>
<input aria-describedby="registerPasswordError registerPasswordHelp" autocomplete="new-password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent form-input" id="registerPassword" name="password" placeholder="أدخل كلمة مرور قوية" required="" type="password"/>
<p class="text-xs text-gray-500 mt-1" id="registerPasswordHelp">يجب أن تحتوي على 6 أحرف على الأقل</p>
<div aria-live="polite" class="error-message" id="registerPasswordError" role="alert" style="display: none;"></div>
</div>
<div>
<label class="block text-gray-700 font-semibold mb-2" for="confirmPassword">تأكيد كلمة المرور <span aria-label="حقل مطلوب" class="text-red-500">*</span></label>
<input aria-describedby="confirmPasswordError" autocomplete="new-password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent form-input" id="confirmPassword" name="confirmPassword" placeholder="أعد إدخال كلمة المرور" required="" type="password"/>
<div aria-live="polite" class="error-message" id="confirmPasswordError" role="alert" style="display: none;"></div>
</div>
<div class="flex items-start gap-3">
<input aria-describedby="agreeTermsError" class="w-5 h-5 text-purple-600 mt-1 form-input" id="agreeTerms" name="agreeTerms" required="" type="checkbox"/>
<label class="text-sm text-gray-700" for="agreeTerms">أوافق على <a aria-label="اقرأ الشروط والأحكام" class="text-purple-600 hover:underline focus:underline" href="#">الشروط والأحكام</a></label>
<div aria-live="polite" class="error-message" id="agreeTermsError" role="alert" style="display: none;"></div>
</div>
<button aria-describedby="registerStatus" class="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white py-3 rounded-lg font-semibold hover:from-green-600 hover:to-blue-600 transform hover:scale-105 transition-all duration-200 btn" id="registerBtn" type="submit">
<span class="btn-text">إنشاء حساب جديد</span>
<div aria-hidden="true" class="loading-overlay" style="display: none;">
<div class="loading-spinner"></div>
<span>جاري إنشاء الحساب<span class="loading-dots"></span></span>
</div>
</button>
<div aria-atomic="true" aria-live="polite" class="sr-only" id="registerStatus"></div>
</form>
</div>
</div>
</div>
<!-- Main Dashboard -->
<div class="hidden min-h-screen" id="mainPage">
<!-- Header -->
<header class="bg-white shadow-lg sticky top-0 z-50" role="banner">
<div class="container mx-auto px-4 py-4">
<div class="flex items-center justify-between">
<div class="flex items-center gap-3">
<div aria-label="شعار ARX-Shop" class="w-12 h-12 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center" role="img">
<span aria-hidden="true" class="text-white text-xl font-bold">🛒</span>
</div>
<h1 class="text-2xl font-bold text-gray-800">ARX-Shop</h1>
</div>
<div class="flex items-center gap-4">
<div class="relative">
<div aria-live="polite" class="bg-gradient-to-r from-green-500 to-blue-500 text-white px-4 py-2 rounded-full text-sm font-medium" role="status">
<span aria-hidden="true">📊</span> <span id="productCount">0</span> منتج متاح
                            </div>
<div aria-live="polite" class="product-badge" id="newProductBadge" role="status" style="display: none;">
                                جديد
                            </div>
</div>
<span class="text-gray-600 font-medium" id="welcomeUser" role="status"></span>
<button aria-label="تسجيل الخروج من الحساب" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors btn" onclick="logout()">
                            تسجيل الخروج
                        </button>
</div>
</div>
</div>
</header>
<!-- Navigation Menu -->
<nav aria-label="القائمة الرئيسية" class="bg-gradient-to-r from-purple-500 to-blue-500 text-white py-4" role="navigation">
<div class="container mx-auto px-4">
<div class="flex flex-wrap gap-4 justify-center">
<button aria-label="عرض معلومات عن الشركة" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-6 py-2 rounded-full transition-all relative btn" id="aboutBtn" onclick="showAboutWithLoading()">
<span class="btn-text">من نحن</span>
<div aria-hidden="true" class="loading-overlay" style="display: none;">
<div class="loading-spinner"></div>
</div>
</button>
<button aria-label="التواصل مع فريق الدعم الفني" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-6 py-2 rounded-full transition-all relative btn" id="supportBtn" onclick="contactSupportWithLoading()">
<span class="btn-text">التواصل مع الدعم</span>
<div aria-hidden="true" class="loading-overlay" style="display: none;">
<div class="loading-spinner"></div>
</div>
</button>
<button aria-label="إضافة منتج جديد للبيع" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-6 py-2 rounded-full transition-all relative btn" id="sellBtn" onclick="showSellFormWithLoading()">
<span class="btn-text">عرض منتج للبيع</span>
<div aria-hidden="true" class="loading-overlay" style="display: none;">
<div class="loading-spinner"></div>
</div>
</button>
<button aria-label="عرض جميع المنتجات المتاحة" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-6 py-2 rounded-full transition-all relative btn" id="productsBtn" onclick="showProductsWithLoading()">
<span class="btn-text">تصفح المنتجات</span>
<div aria-hidden="true" class="loading-overlay" style="display: none;">
<div class="loading-spinner"></div>
</div>
</button>
</div>
</div>
</nav>
<!-- Main Content Area -->
<main class="container mx-auto px-4 py-8 min-h-screen" id="main-content" role="main">
<!-- Welcome Section -->
<section aria-labelledby="welcome-heading" class="text-center py-16" id="welcomeSection">
<div class="max-w-3xl mx-auto">
<h1 class="text-4xl font-bold text-gray-800 mb-6" id="welcome-heading">
<span class="typing-indicator" id="welcomeText">مرحباً بك في ARX-Shop</span>
</h1>
<h2 class="text-xl text-gray-600 mb-8">منصتك المثالية للبيع والشراء بأمان وسهولة - آلاف المنتجات في انتظارك</h2>
<!-- إحصائيات مباشرة -->
<div aria-label="إحصائيات الموقع" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8" role="region">
<div aria-live="polite" class="bg-gradient-to-r from-blue-500 to-purple-500 text-white p-6 rounded-xl glow-effect" role="status">
<div aria-label="إجمالي المنتجات" class="text-3xl font-bold" id="totalProducts">0</div>
<div class="text-sm opacity-90">إجمالي المنتجات</div>
</div>
<div aria-live="polite" class="bg-gradient-to-r from-green-500 to-teal-500 text-white p-6 rounded-xl" role="status">
<div aria-label="منتجات اليوم" class="text-3xl font-bold" id="todayProducts">0</div>
<div class="text-sm opacity-90">منتجات اليوم</div>
</div>
<div aria-live="polite" class="bg-gradient-to-r from-orange-500 to-red-500 text-white p-6 rounded-xl" role="status">
<div aria-label="المستخدمون النشطون" class="text-3xl font-bold" id="activeUsers">1</div>
<div class="text-sm opacity-90">المستخدمون النشطون</div>
</div>
</div>
<div aria-label="الخدمات الرئيسية" class="grid md:grid-cols-3 gap-8" role="region">
<div aria-label="تصفح المنتجات المتاحة للشراء" class="bg-white p-6 rounded-xl shadow-lg card-hover cursor-pointer transform hover:scale-105 transition-all duration-300 btn" onclick="showProducts()" onkeydown="if(event.key==='Enter'||event.key===' ') showProducts()" role="button" tabindex="0">
<div aria-hidden="true" class="text-4xl mb-4">🛍️</div>
<h3 class="text-xl font-semibold mb-2">تسوق بأمان</h3>
<p class="text-gray-600 mb-4">تصفح آلاف المنتجات من بائعين موثوقين</p>
<div class="bg-gradient-to-r from-purple-500 to-blue-500 text-white px-4 py-2 rounded-full text-sm text-center">
                                ابدأ التسوق الآن
                            </div>
</div>
<div aria-label="عرض منتج للبيع وكسب المال" class="bg-white p-6 rounded-xl shadow-lg card-hover cursor-pointer transform hover:scale-105 transition-all duration-300 btn" onclick="showSellForm()" onkeydown="if(event.key==='Enter'||event.key===' ') showSellForm()" role="button" tabindex="0">
<div aria-hidden="true" class="text-4xl mb-4">💰</div>
<h3 class="text-xl font-semibold mb-2">بع منتجاتك</h3>
<p class="text-gray-600 mb-4">اعرض منتجاتك واربح المال بسهولة</p>
<div class="bg-gradient-to-r from-green-500 to-blue-500 text-white px-4 py-2 rounded-full text-sm text-center">
                                عرض منتج للبيع
                            </div>
</div>
<div aria-label="التواصل مع فريق الدعم الفني" class="bg-white p-6 rounded-xl shadow-lg card-hover cursor-pointer transform hover:scale-105 transition-all duration-300 btn" onclick="contactSupport()" onkeydown="if(event.key==='Enter'||event.key===' ') contactSupport()" role="button" tabindex="0">
<div aria-hidden="true" class="text-4xl mb-4">🤝</div>
<h3 class="text-xl font-semibold mb-2">دعم متميز</h3>
<p class="text-gray-600 mb-4">فريق دعم متاح على مدار الساعة</p>
<div class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-4 py-2 rounded-full text-sm text-center">
                                تواصل مع الدعم
                            </div>
</div>
</div>
</div>
</section></main></div>
<!-- About Section -->
<div class="hidden fade-in" id="aboutSection">
<div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl p-8">
<header>
<h1 class="text-3xl font-bold text-center mb-8 text-gray-800">من نحن - ARX-Shop منصة التجارة الإلكترونية الموثوقة</h1>
</header>
<div class="space-y-6 text-gray-700 leading-relaxed">
<div class="bg-gradient-to-r from-purple-50 to-blue-50 p-6 rounded-xl">
<h3 class="text-xl font-semibold mb-3 text-purple-700">🎯 رؤيتنا</h3>
<p>نسعى لأن نكون المنصة الرائدة في التجارة الإلكترونية في المنطقة، حيث نربط البائعين والمشترين في بيئة آمنة وموثوقة.</p>
</div>
<div class="bg-gradient-to-r from-blue-50 to-green-50 p-6 rounded-xl">
<h3 class="text-xl font-semibold mb-3 text-blue-700">⚙️ كيف يعمل الموقع</h3>
<div class="grid md:grid-cols-2 gap-4">
<div>
<h4 class="font-semibold text-green-600 mb-2">للبائعين:</h4>
<ul class="space-y-1 text-sm">
<li>• سجل دخولك إلى المنصة</li>
<li>• اضغط على "عرض منتج للبيع"</li>
<li>• املأ تفاصيل المنتج وأضف الصور</li>
<li>• حدد طريقة التواصل معك</li>
<li>• انشر منتجك ليراه الآلاف</li>
</ul>
</div>
<div>
<h4 class="font-semibold text-blue-600 mb-2">للمشترين:</h4>
<ul class="space-y-1 text-sm">
<li>• تصفح المنتجات حسب الفئة</li>
<li>• اقرأ تفاصيل المنتج والأسعار</li>
<li>• تواصل مع البائع مباشرة</li>
<li>• اتفق على طريقة الدفع والتسليم</li>
<li>• استلم منتجك بأمان</li>
</ul>
</div>
</div>
</div>
<div class="bg-gradient-to-r from-green-50 to-yellow-50 p-6 rounded-xl">
<h3 class="text-xl font-semibold mb-3 text-green-700">🛡️ الأمان والثقة</h3>
<p>نحن نضمن بيئة آمنة للتداول من خلال التحقق من هوية المستخدمين وتوفير قنوات تواصل موثوقة. كما نوفر دعماً فنياً متاحاً على مدار الساعة لحل أي مشاكل قد تواجهك.</p>
</div>
</div>
<div class="text-center mt-8">
<button class="bg-gradient-to-r from-purple-500 to-blue-500 text-white px-8 py-3 rounded-full hover:from-purple-600 hover:to-blue-600 transition-all" onclick="showWelcome()">
                            العودة للرئيسية
                        </button>
</div>
</div>
</div>
<!-- Sell Product Form -->
<div class="hidden fade-in" id="sellSection">
<div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-xl p-8">
<header>
<h1 class="text-3xl font-bold text-center mb-8 text-gray-800">عرض منتج للبيع - ابدأ البيع على ARX-Shop</h1>
<p class="text-center text-gray-600 mb-6">انشر منتجك واربح المال بسهولة - ملايين المشترين في انتظارك</p>
</header>
<form class="space-y-6" id="sellForm">
<div>
<label class="block text-gray-700 font-semibold mb-2">اسم المنتج</label>
<input class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" id="productName" placeholder="أدخل اسم المنتج" required="" type="text"/>
</div>
<div>
<label class="block text-gray-700 font-semibold mb-2">نوع المنتج</label>
<select class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" id="productCategory" required="">
<option value="">اختر نوع المنتج</option>
<option value="ملابس وإكسسوارات">ملابس وإكسسوارات</option>
<option value="إلكترونيات">إلكترونيات</option>
<option value="أثاث وديكور">أثاث وديكور</option>
<option value="منتجات التجميل والعناية الشخصية">منتجات التجميل والعناية الشخصية</option>
<option value="منتجات منزلية">منتجات منزلية</option>
<option value="رياضة ولياقة">رياضة ولياقة</option>
<option value="ألعاب وهدايا">ألعاب وهدايا</option>
<option value="سيارات وملحقاتها">سيارات وملحقاتها</option>
<option value="برامج وتطبيقات">برامج وتطبيقات</option>
<option value="كتب إلكترونية ومحتوى رقمي">كتب إلكترونية ومحتوى رقمي</option>
<option value="موسيقى وفنون">موسيقى وفنون</option>
<option value="خدمات رقمية">خدمات رقمية</option>
<option value="أطعمة ومشروبات">أطعمة ومشروبات</option>
<option value="منتجات صحية">منتجات صحية</option>
<option value="ملابس أطفال">ملابس أطفال</option>
<option value="ألعاب تعليمية">ألعاب تعليمية</option>
<option value="مستلزمات مدارس">مستلزمات مدارس</option>
<option value="حفاضات وأطعمة أطفال">حفاضات وأطعمة أطفال</option>
<option value="طعام الحيوانات">طعام الحيوانات</option>
<option value="ألعاب وملابس حيوانات">ألعاب وملابس حيوانات</option>
<option value="مستلزمات العناية بالحيوانات">مستلزمات العناية بالحيوانات</option>
<option value="منتجات يدوية">منتجات يدوية</option>
<option value="تحف فنية">تحف فنية</option>
<option value="منتجات مخصصة">منتجات مخصصة</option>
<option value="منتجات صديقة للبيئة">منتجات صديقة للبيئة</option>
<option value="أدوات إعادة تدوير">أدوات إعادة تدوير</option>
<option value="بدائل البلاستيك">بدائل البلاستيك</option>
</select>
</div>
<div>
<label class="block text-gray-700 font-semibold mb-2">وصف المنتج</label>
<textarea class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" id="productDescription" placeholder="اكتب وصفاً مفصلاً للمنتج" required="" rows="4"></textarea>
</div>
<div>
<label class="block text-gray-700 font-semibold mb-2">سعر المنتج</label>
<div class="flex gap-2">
<input class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" id="productPrice" min="0" placeholder="0.00" required="" step="0.01" type="number"/>
<select class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" id="productCurrency">
<option value="ريال">ريال سعودي</option>
<option value="درهم">درهم إماراتي</option>
<option value="دينار">دينار كويتي</option>
<option value="ريال قطري">ريال قطري</option>
<option value="ليرة">ليرة سورية</option>
</select>
</div>
</div>
<div>
<label class="block text-gray-700 font-semibold mb-2">صور المنتج</label>
<div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-purple-500 transition-colors">
<input accept="image/*" class="hidden" id="productImages" multiple="" onchange="handleImageUpload(event)" type="file"/>
<div class="cursor-pointer" onclick="document.getElementById('productImages').click()">
<div class="text-4xl mb-2">📷</div>
<p class="text-gray-600">اضغط لإضافة صور المنتج</p>
<p class="text-sm text-gray-500 mt-1">يمكنك إضافة عدة صور</p>
</div>
<div class="mt-4 grid grid-cols-3 gap-2" id="imagePreview"></div>
</div>
</div>
<div>
<label class="block text-gray-700 font-semibold mb-2">طريقة التواصل</label>
<div class="space-y-3">
<div class="flex items-center gap-3">
<input class="w-4 h-4 text-purple-600" id="contactPhone" type="checkbox"/>
<label for="contactPhone">رقم الهاتف</label>
<input class="flex-1 px-3 py-2 border border-gray-300 rounded-lg" id="contactPhoneNumber" placeholder="رقم الهاتف للتواصل" type="tel"/>
</div>
<div class="flex items-center gap-3">
<input class="w-4 h-4 text-purple-600" id="contactWhatsapp" type="checkbox"/>
<label for="contactWhatsapp">واتساب</label>
<input class="flex-1 px-3 py-2 border border-gray-300 rounded-lg" id="contactWhatsappNumber" placeholder="رقم الواتساب" type="tel"/>
</div>
<div class="flex items-center gap-3">
<input class="w-4 h-4 text-purple-600" id="contactTelegram" type="checkbox"/>
<label for="contactTelegram">تليجرام</label>
<input class="flex-1 px-3 py-2 border border-gray-300 rounded-lg" id="contactTelegramUsername" placeholder="اسم المستخدم في تليجرام" type="text"/>
</div>
</div>
</div>
<div class="flex gap-4">
<button class="flex-1 bg-gradient-to-r from-green-500 to-blue-500 text-white py-3 rounded-lg font-semibold hover:from-green-600 hover:to-blue-600 transition-all relative" id="publishBtn" type="submit">
<span class="btn-text">نشر المنتج</span>
<div class="loading-overlay" style="display: none;">
<div class="loading-spinner"></div>
<span>جاري النشر<span class="loading-dots"></span></span>
</div>
</button>
<button class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors" onclick="showWelcome()" type="button">
                                إلغاء
                            </button>
</div>
</form>
</div>
</div>
<!-- Products Browse Section -->
<div class="hidden fade-in" id="productsSection">
<div class="max-w-6xl mx-auto">
<header>
<h1 class="text-3xl font-bold text-center mb-4 text-gray-800">تصفح المنتجات - آلاف المنتجات بأفضل الأسعار</h1>
<p class="text-center text-gray-600 mb-8">اكتشف منتجات متنوعة من بائعين موثوقين - ملابس، إلكترونيات، أثاث وأكثر</p>
</header>
<!-- Search and Filter -->
<div class="bg-white rounded-xl shadow-lg p-6 mb-8">
<div class="mb-6">
<h3 class="text-xl font-semibold mb-4 text-gray-800">🔍 البحث والتصفية</h3>
<div class="flex gap-4 mb-4">
<input class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" id="searchInput" onkeyup="searchProducts()" placeholder="ابحث عن منتج..." type="text"/>
<select class="px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" id="sortSelect" onchange="sortProducts()">
<option value="newest">الأحدث</option>
<option value="oldest">الأقدم</option>
<option value="price-low">السعر: من الأقل للأعلى</option>
<option value="price-high">السعر: من الأعلى للأقل</option>
<option value="popular">الأكثر مشاهدة</option>
<option value="favorites">الأكثر إعجاباً</option>
</select>
</div>
</div>
<h3 class="text-xl font-semibold mb-4 text-gray-800">🏷️ تصفية حسب الفئة</h3>
<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3">
<button class="category-filter active bg-gradient-to-r from-purple-500 to-blue-500 text-white px-4 py-3 rounded-lg text-sm font-medium hover:from-purple-600 hover:to-blue-600 transition-all transform hover:scale-105 shadow-md" onclick="filterProducts('all')">
                                🛍️ جميع المنتجات
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('ملابس وإكسسوارات')">
                                👗 ملابس وإكسسوارات
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('إلكترونيات')">
                                📱 إلكترونيات
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('أثاث وديكور')">
                                🪑 أثاث وديكور
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('منتجات التجميل والعناية الشخصية')">
                                💄 تجميل وعناية
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('منتجات منزلية')">
                                🏠 منتجات منزلية
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('رياضة ولياقة')">
                                ⚽ رياضة ولياقة
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('ألعاب وهدايا')">
                                🎮 ألعاب وهدايا
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('سيارات وملحقاتها')">
                                🚗 سيارات وملحقات
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('برامج وتطبيقات')">
                                💻 برامج وتطبيقات
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('كتب إلكترونية ومحتوى رقمي')">
                                📚 كتب ومحتوى رقمي
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('موسيقى وفنون')">
                                🎵 موسيقى وفنون
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('خدمات رقمية')">
                                🌐 خدمات رقمية
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('أطعمة ومشروبات')">
                                🍕 أطعمة ومشروبات
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('منتجات صحية')">
                                💊 منتجات صحية
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('ملابس أطفال')">
                                👶 ملابس أطفال
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('ألعاب تعليمية')">
                                🧩 ألعاب تعليمية
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('مستلزمات مدارس')">
                                🎒 مستلزمات مدارس
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('حفاضات وأطعمة أطفال')">
                                🍼 حفاضات وأطعمة أطفال
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('طعام الحيوانات')">
                                🐕 طعام الحيوانات
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('ألعاب وملابس حيوانات')">
                                🐾 ألعاب وملابس حيوانات
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('مستلزمات العناية بالحيوانات')">
                                🐱 مستلزمات العناية بالحيوانات
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('منتجات يدوية')">
                                ✋ منتجات يدوية
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('تحف فنية')">
                                🎨 تحف فنية
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('منتجات مخصصة')">
                                ⚙️ منتجات مخصصة
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('منتجات صديقة للبيئة')">
                                🌱 منتجات صديقة للبيئة
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('أدوات إعادة تدوير')">
                                ♻️ أدوات إعادة تدوير
                            </button>
<button class="category-filter bg-gray-100 text-gray-700 px-4 py-3 rounded-lg text-sm font-medium hover:bg-gray-200 transition-all transform hover:scale-105 shadow-sm" onclick="filterProducts('بدائل البلاستيك')">
                                🌿 بدائل البلاستيك
                            </button>
</div>
</div>
<!-- Products Grid -->
<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" id="productsGrid">
<!-- Products will be displayed here -->
</div>
<div class="text-center py-16" id="noProducts">
<div class="text-6xl mb-4">🛍️</div>
<h3 class="text-2xl font-semibold text-gray-600 mb-2">لا توجد منتجات حالياً</h3>
<p class="text-gray-500 mb-6">كن أول من يعرض منتجاً للبيع!</p>
<button class="bg-gradient-to-r from-purple-500 to-blue-500 text-white px-8 py-3 rounded-full hover:from-purple-600 hover:to-blue-600 transition-all" onclick="showSellForm()">
                            عرض منتج للبيع
                        </button>
</div>
<div class="text-center mt-8">
<button class="bg-gray-500 text-white px-8 py-3 rounded-full hover:bg-gray-600 transition-all" onclick="showWelcome()">
                            العودة للرئيسية
                        </button>
</div>
</div>
</div>
<!-- Footer -->
<footer class="bg-gray-800 text-white py-8 mt-16">
<div class="container mx-auto px-4 text-center">
<div class="flex items-center justify-center gap-3 mb-4">
<div class="w-10 h-10 bg-gradient-to-r from-purple-500 to-blue-500 rounded-full flex items-center justify-center">
<span class="text-white font-bold">🛒</span>
</div>
<h3 class="text-xl font-bold">ARX-Shop</h3>
</div>
<p class="text-gray-400 mb-4">منصتك الموثوقة للبيع والشراء الآمن</p>
<div class="border-t border-gray-700 pt-4">
<p class="text-sm text-gray-500">
                        © 2024 ARX-Shop. جميع الحقوق محفوظة.
                    </p>
</div>
</div>
</footer>
<script>
        // Global variables
        let currentUser = null;
        let products = JSON.parse(localStorage.getItem('products')) || [];
        let users = JSON.parse(localStorage.getItem('users')) || [];
        let currentFilter = 'all';

        // Accessibility functions
        function initializeAccessibility() {
            // Detect keyboard navigation
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    document.body.classList.add('keyboard-user');
                }
            });
            
            document.addEventListener('mousedown', function() {
                document.body.classList.remove('keyboard-user');
            });
            
            // Add ARIA live regions for dynamic content
            const liveRegion = document.createElement('div');
            liveRegion.setAttribute('aria-live', 'polite');
            liveRegion.setAttribute('aria-atomic', 'true');
            liveRegion.className = 'sr-only';
            liveRegion.id = 'live-region';
            document.body.appendChild(liveRegion);
            
            // Announce page changes to screen readers
            window.announceToScreenReader = function(message) {
                const liveRegion = document.getElementById('live-region');
                if (liveRegion) {
                    liveRegion.textContent = message;
                    setTimeout(() => {
                        liveRegion.textContent = '';
                    }, 1000);
                }
            };
        }
        
        // Form validation with accessibility
        function validateField(fieldId, errorId, validationFn, errorMessage) {
            const field = document.getElementById(fieldId);
            const errorDiv = document.getElementById(errorId);
            
            if (!field || !errorDiv) return true;
            
            const isValid = validationFn(field.value);
            
            if (!isValid) {
                field.classList.add('error');
                field.setAttribute('aria-invalid', 'true');
                errorDiv.textContent = errorMessage;
                errorDiv.style.display = 'flex';
                return false;
            } else {
                field.classList.remove('error');
                field.setAttribute('aria-invalid', 'false');
                errorDiv.style.display = 'none';
                return true;
            }
        }
        
        // Auth form switching
        function showLoginForm() {
            document.getElementById('loginTab').classList.add('active');
            document.getElementById('registerTab').classList.remove('active');
            document.getElementById('loginFormContainer').classList.remove('hidden');
            document.getElementById('registerFormContainer').classList.add('hidden');
            
            // Update ARIA attributes
            document.getElementById('loginTab').setAttribute('aria-selected', 'true');
            document.getElementById('registerTab').setAttribute('aria-selected', 'false');
            
            // Update tab styles
            document.getElementById('loginTab').classList.add('bg-gradient-to-r', 'from-purple-500', 'to-blue-500', 'text-white');
            document.getElementById('loginTab').classList.remove('text-gray-600');
            document.getElementById('registerTab').classList.remove('bg-gradient-to-r', 'from-purple-500', 'to-blue-500', 'text-white');
            document.getElementById('registerTab').classList.add('text-gray-600');
            
            // Focus management
            setTimeout(() => {
                document.getElementById('loginEmail').focus();
            }, 100);
            
            announceToScreenReader('تم التبديل إلى نموذج تسجيل الدخول');
        }

        function showRegisterForm() {
            document.getElementById('registerTab').classList.add('active');
            document.getElementById('loginTab').classList.remove('active');
            document.getElementById('registerFormContainer').classList.remove('hidden');
            document.getElementById('loginFormContainer').classList.add('hidden');
            
            // Update ARIA attributes
            document.getElementById('registerTab').setAttribute('aria-selected', 'true');
            document.getElementById('loginTab').setAttribute('aria-selected', 'false');
            
            // Update tab styles
            document.getElementById('registerTab').classList.add('bg-gradient-to-r', 'from-purple-500', 'to-blue-500', 'text-white');
            document.getElementById('registerTab').classList.remove('text-gray-600');
            document.getElementById('loginTab').classList.remove('bg-gradient-to-r', 'from-purple-500', 'to-blue-500', 'text-white');
            document.getElementById('loginTab').classList.add('text-gray-600');
            
            // Focus management
            setTimeout(() => {
                document.getElementById('registerName').focus();
            }, 100);
            
            announceToScreenReader('تم التبديل إلى نموذج إنشاء حساب جديد');
        }

        // Loading functions
        function showButtonLoading(buttonId, loadingText = '') {
            const button = document.getElementById(buttonId);
            if (button) {
                button.classList.add('btn-loading');
                const loadingOverlay = button.querySelector('.loading-overlay');
                if (loadingOverlay) {
                    loadingOverlay.style.display = 'flex';
                    if (loadingText) {
                        const textSpan = loadingOverlay.querySelector('span');
                        if (textSpan) textSpan.innerHTML = loadingText + '<span class="loading-dots"></span>';
                    }
                }
            }
        }
        
        function hideButtonLoading(buttonId) {
            const button = document.getElementById(buttonId);
            if (button) {
                button.classList.remove('btn-loading');
                const loadingOverlay = button.querySelector('.loading-overlay');
                if (loadingOverlay) {
                    loadingOverlay.style.display = 'none';
                }
            }
        }
        
        function simulateLoading(callback, duration = 2000) {
            setTimeout(callback, duration);
        }

        // Register functionality
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const countryCode = document.getElementById('registerCountryCode').value;
            const phone = document.getElementById('registerPhone').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const agreeTerms = document.getElementById('agreeTerms').checked;
            
            // Validation
            if (!name || !phone || !email || !password || !confirmPassword) {
                showNotification('⚠️ يرجى ملء جميع الحقول المطلوبة', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('⚠️ كلمة المرور يجب أن تحتوي على 6 أحرف على الأقل', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('⚠️ كلمة المرور وتأكيد كلمة المرور غير متطابقتين', 'error');
                return;
            }
            
            if (!agreeTerms) {
                showNotification('⚠️ يجب الموافقة على الشروط والأحكام', 'error');
                return;
            }
            
            // Check if email already exists
            if (users.find(user => user.email === email)) {
                showNotification('⚠️ البريد الإلكتروني مسجل مسبقاً', 'error');
                return;
            }
            
            showButtonLoading('registerBtn', 'جاري إنشاء الحساب');
            
            simulateLoading(() => {
                const newUser = {
                    id: Date.now(),
                    name: name,
                    phone: countryCode + phone,
                    email: email,
                    password: password, // في التطبيق الحقيقي يجب تشفير كلمة المرور
                    dateRegistered: new Date().toLocaleDateString('ar-SA')
                };
                
                users.push(newUser);
                StorageManager.set('users', users);
                
                hideButtonLoading('registerBtn');
                showNotification('🎉 تم إنشاء الحساب بنجاح! يمكنك الآن تسجيل الدخول', 'success');
                
                // Reset form and switch to login
                document.getElementById('registerForm').reset();
                showLoginForm();
                
                // Pre-fill login email
                document.getElementById('loginEmail').value = email;
            }, 2000);
        });

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showNotification('⚠️ يرجى إدخال البريد الإلكتروني وكلمة المرور', 'error');
                return;
            }
            
            showButtonLoading('loginBtn', 'جاري تسجيل الدخول');
            
            simulateLoading(() => {
                const user = users.find(u => u.email === email && u.password === password);
                
                if (user) {
                    currentUser = user;
                    StorageManager.set('currentUser', currentUser);
                    
                    document.getElementById('authPage').classList.add('hidden');
                    document.getElementById('mainPage').classList.remove('hidden');
                    document.getElementById('welcomeUser').textContent = `مرحباً، ${user.name}`;
                    
                    hideButtonLoading('loginBtn');
                    showWelcome();
                    showNotification('🎉 تم تسجيل الدخول بنجاح!', 'success');
                } else {
                    hideButtonLoading('loginBtn');
                    showNotification('❌ البريد الإلكتروني أو كلمة المرور غير صحيحة', 'error');
                }
            }, 1500);
        });

        // Navigation functions with loading
        function showAboutWithLoading() {
            showButtonLoading('aboutBtn');
            simulateLoading(() => {
                hideButtonLoading('aboutBtn');
                showAbout();
            }, 800);
        }
        
        function contactSupportWithLoading() {
            showButtonLoading('supportBtn');
            simulateLoading(() => {
                hideButtonLoading('supportBtn');
                contactSupport();
            }, 500);
        }
        
        function showSellFormWithLoading() {
            showButtonLoading('sellBtn');
            simulateLoading(() => {
                hideButtonLoading('sellBtn');
                showSellForm();
            }, 1000);
        }
        
        function showProductsWithLoading() {
            showButtonLoading('productsBtn');
            simulateLoading(() => {
                hideButtonLoading('productsBtn');
                showProducts();
            }, 1200);
        }

        // Original navigation functions with SEO updates
        function showWelcome() {
            hideAllSections();
            document.getElementById('welcomeSection').classList.remove('hidden');
            updatePageMeta('welcome');
            
            // Update URL without page reload
            if (history.pushState) {
                history.pushState(null, null, '/');
            }
            
            // Focus management and screen reader announcement
            document.getElementById('welcome-heading').focus();
            announceToScreenReader('تم الانتقال إلى الصفحة الرئيسية');
        }

        function showAbout() {
            hideAllSections();
            document.getElementById('aboutSection').classList.remove('hidden');
            updatePageMeta('about');
            
            // Update URL without page reload
            if (history.pushState) {
                history.pushState(null, null, '/about');
            }
        }

        function contactSupport() {
            // Open Telegram (placeholder URL - replace with actual company Telegram)
            window.open('https://t.me/your_company_support', '_blank');
        }

        function showSellForm() {
            hideAllSections();
            document.getElementById('sellSection').classList.remove('hidden');
            document.getElementById('sellForm').reset();
            document.getElementById('imagePreview').innerHTML = '';
            updatePageMeta('sell');
            
            // Update URL without page reload
            if (history.pushState) {
                history.pushState(null, null, '/sell');
            }
        }

        function showProducts() {
            hideAllSections();
            document.getElementById('productsSection').classList.remove('hidden');
            displayProducts();
            updatePageMeta('products');
            
            // Update URL without page reload
            if (history.pushState) {
                history.pushState(null, null, '/products');
            }
        }

        function hideAllSections() {
            document.getElementById('welcomeSection').classList.add('hidden');
            document.getElementById('aboutSection').classList.add('hidden');
            document.getElementById('sellSection').classList.add('hidden');
            document.getElementById('productsSection').classList.add('hidden');
        }

        // Image upload handling with compression
        function handleImageUpload(event) {
            const files = event.target.files;
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';
            
            for (let i = 0; i < files.length && i < 6; i++) {
                const file = files[i];
                
                // Compress image before processing
                compressImage(file, 0.7, 800, 600).then(compressedFile => {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const img = document.createElement('div');
                        img.className = 'relative';
                        img.innerHTML = `
                            <img src="${e.target.result}" class="w-full h-20 object-cover rounded-lg" loading="lazy" alt="صورة المنتج - معاينة">
                            <button type="button" onclick="this.parentElement.remove()" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-6 h-6 text-xs hover:bg-red-600" aria-label="حذف الصورة">×</button>
                        `;
                        preview.appendChild(img);
                    };
                    
                    reader.readAsDataURL(compressedFile);
                });
            }
        }

        // Image compression function
        function compressImage(file, quality = 0.7, maxWidth = 800, maxHeight = 600) {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = function() {
                    // Calculate new dimensions
                    let { width, height } = img;
                    
                    if (width > maxWidth || height > maxHeight) {
                        const ratio = Math.min(maxWidth / width, maxHeight / height);
                        width *= ratio;
                        height *= ratio;
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Draw and compress
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    canvas.toBlob(resolve, 'image/jpeg', quality);
                };
                
                img.src = URL.createObjectURL(file);
            });
        }

        // Sell form submission
        document.addEventListener('DOMContentLoaded', function() {
            const sellForm = document.getElementById('sellForm');
            if (sellForm) {
                sellForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const productName = document.getElementById('productName').value;
                    const productCategory = document.getElementById('productCategory').value;
                    const productDescription = document.getElementById('productDescription').value;
                    const productPrice = document.getElementById('productPrice').value;
                    const productCurrency = document.getElementById('productCurrency').value;
                    
                    if (!productName || !productCategory || !productDescription || !productPrice) {
                        showNotification('⚠️ يرجى ملء جميع الحقول المطلوبة', 'error');
                        return;
                    }
                    
                    // Get contact methods
                    const contactMethods = [];
                    if (document.getElementById('contactPhone').checked) {
                        const phoneValue = document.getElementById('contactPhoneNumber').value;
                        if (phoneValue) {
                            contactMethods.push({
                                type: 'phone',
                                value: phoneValue
                            });
                        }
                    }
                    if (document.getElementById('contactWhatsapp').checked) {
                        const whatsappValue = document.getElementById('contactWhatsappNumber').value;
                        if (whatsappValue) {
                            contactMethods.push({
                                type: 'whatsapp',
                                value: whatsappValue
                            });
                        }
                    }
                    if (document.getElementById('contactTelegram').checked) {
                        const telegramValue = document.getElementById('contactTelegramUsername').value;
                        if (telegramValue) {
                            contactMethods.push({
                                type: 'telegram',
                                value: telegramValue
                            });
                        }
                    }
                    
                    // Get images
                    const images = [];
                    const imageElements = document.querySelectorAll('#imagePreview img');
                    imageElements.forEach(img => {
                        images.push(img.src);
                    });
                    
                    if (contactMethods.length === 0) {
                        showNotification('⚠️ يرجى اختيار طريقة تواصل واحدة على الأقل', 'error');
                        return;
                    }
                    
                    // Show loading
                    showButtonLoading('publishBtn', 'جاري النشر');
                    
                    // Simulate publishing process
                    simulateLoading(() => {
                        const newProduct = {
                            id: Date.now(),
                            name: productName,
                            category: productCategory,
                            description: productDescription,
                            price: productPrice,
                            currency: productCurrency,
                            images: images,
                            contactMethods: contactMethods,
                            seller: currentUser ? currentUser.name : 'مستخدم مجهول',
                            sellerId: currentUser ? currentUser.id : null,
                            dateAdded: new Date().toLocaleDateString('ar-SA'),
                            rating: 0,
                            ratingCount: 0,
                            favorites: 0,
                            views: 0,
                            isNew: true
                        };
                        
                        products.push(newProduct);
                        StorageManager.set('products', products);
                        
                        // Hide loading
                        hideButtonLoading('publishBtn');
                        
                        // إظهار تأثيرات الاحتفال
                        createFloatingHearts();
                        showNotification('🎉 تم نشر المنتج بنجاح!', 'success');
                        updateProductCount();
                        
                        // Reset form
                        sellForm.reset();
                        document.getElementById('imagePreview').innerHTML = '';
                        
                        // Show products page
                        setTimeout(() => {
                            showProducts();
                        }, 1000);
                    }, 2500);
                });
            }
        });

        // Products display with virtual scrolling and lazy loading
        let displayedProducts = [];
        let currentPage = 0;
        const productsPerPage = 12;

        function displayProducts() {
            const grid = document.getElementById('productsGrid');
            const noProducts = document.getElementById('noProducts');
            
            if (!grid || !noProducts) {
                return;
            }
            
            let filteredProducts = products;
            if (currentFilter !== 'all') {
                filteredProducts = products.filter(product => product.category === currentFilter);
            }
            
            if (filteredProducts.length === 0) {
                grid.classList.add('hidden');
                noProducts.classList.remove('hidden');
                return;
            }
            
            grid.classList.remove('hidden');
            noProducts.classList.add('hidden');
            
            // Reset pagination
            currentPage = 0;
            displayedProducts = filteredProducts;
            
            renderProductsPage();
            setupInfiniteScroll();
        }

        function renderProductsPage() {
            const grid = document.getElementById('productsGrid');
            const startIndex = currentPage * productsPerPage;
            const endIndex = startIndex + productsPerPage;
            const pageProducts = displayedProducts.slice(startIndex, endIndex);
            
            if (currentPage === 0) {
                grid.innerHTML = '';
            }
            
            const fragment = document.createDocumentFragment();
            
            pageProducts.forEach(product => {
                const productElement = createProductElement(product);
                fragment.appendChild(productElement);
            });
            
            grid.appendChild(fragment);
            currentPage++;
        }

        function createProductElement(product) {
            const div = document.createElement('div');
            div.className = 'bg-white rounded-xl shadow-lg overflow-hidden card-hover';
            div.onclick = () => viewProduct(product.id);
            
            const contactMethodsHTML = product.contactMethods.map(contact => {
                if (contact.type === 'phone') {
                    return `<a href="tel:${contact.value}" class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs hover:bg-blue-200 transition-colors">📞 ${contact.value}</a>`;
                } else if (contact.type === 'whatsapp') {
                    return `<a href="https://wa.me/${contact.value.replace(/[^0-9]/g, '')}" target="_blank" class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs hover:bg-green-200 transition-colors">💬 واتساب</a>`;
                } else if (contact.type === 'telegram') {
                    return `<a href="https://t.me/${contact.value}" target="_blank" class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-xs hover:bg-purple-200 transition-colors">✈️ تليجرام</a>`;
                }
                return '';
            }).join('');
            
            div.innerHTML = `
                <div class="relative">
                    ${product.images && product.images.length > 0 ? 
                        `<img src="${product.images[0]}" class="w-full h-48 object-cover" alt="${product.name} - ${product.category} للبيع على ARX-Shop" loading="lazy">` :
                        `<div class="w-full h-48 bg-gradient-to-br from-purple-100 to-blue-100 flex items-center justify-center" role="img" aria-label="صورة افتراضية للمنتج">
                            <span class="text-6xl">📦</span>
                        </div>`
                    }
                    <div class="absolute top-2 right-2 bg-purple-500 text-white px-2 py-1 rounded-full text-xs">
                        ${product.category}
                    </div>
                    ${product.isNew ? '<div class="absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs animate-pulse">🔥 جديد</div>' : ''}
                    <div class="absolute bottom-2 left-2 flex gap-1">
                        <button onclick="event.stopPropagation(); toggleFavorite(${product.id})" class="bg-white bg-opacity-80 hover:bg-opacity-100 p-2 rounded-full transition-all">
                            <span class="text-red-500">❤️</span>
                        </button>
                        <div class="bg-white bg-opacity-80 px-2 py-1 rounded-full text-xs">
                            👁️ ${product.views || 0}
                        </div>
                    </div>
                </div>
                <div class="p-6">
                    <h3 class="text-xl font-semibold mb-2 text-gray-800">${product.name}</h3>
                    <p class="text-gray-600 mb-3" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${product.description}</p>
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-2xl font-bold text-green-600">${product.price} ${product.currency || 'ريال'}</span>
                        <span class="text-sm text-gray-500">بواسطة: ${product.seller}</span>
                    </div>
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-2">
                            <div class="flex text-yellow-400">
                                ${'★'.repeat(Math.floor(product.rating || 0))}${'☆'.repeat(5 - Math.floor(product.rating || 0))}
                            </div>
                            <span class="text-sm text-gray-500">(${product.ratingCount || 0})</span>
                        </div>
                        <div class="flex items-center gap-2 text-sm text-gray-500">
                            <span>❤️ ${product.favorites || 0}</span>
                            <span>👁️ ${product.views || 0}</span>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <p class="text-sm text-gray-600 font-medium">طرق التواصل:</p>
                        <div class="flex flex-wrap gap-2">
                            ${contactMethodsHTML}
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <span class="text-xs text-gray-500">تاريخ النشر: ${product.dateAdded}</span>
                    </div>
                </div>
            `;
            
            return div;
        }

        function setupInfiniteScroll() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && currentPage * productsPerPage < displayedProducts.length) {
                        renderProductsPage();
                    }
                });
            }, {
                rootMargin: '100px'
            });
            
            // Observe the last product element
            const lastProduct = document.querySelector('#productsGrid > div:last-child');
            if (lastProduct) {
                observer.observe(lastProduct);
            }
        }

        // Filter products
        function filterProducts(category) {
            console.log('تصفية المنتجات حسب:', category);
            
            currentFilter = category;
            
            // Update filter buttons
            document.querySelectorAll('.category-filter').forEach(btn => {
                btn.classList.remove('active', 'bg-gradient-to-r', 'from-purple-500', 'to-blue-500', 'text-white', 'shadow-md');
                btn.classList.add('bg-gray-100', 'text-gray-700', 'shadow-sm');
            });
            
            // Find and highlight the active button
            const activeButton = Array.from(document.querySelectorAll('.category-filter')).find(btn => {
                const btnText = btn.textContent.trim();
                return btnText.includes(category === 'all' ? 'جميع المنتجات' : category);
            });
            
            if (activeButton) {
                activeButton.classList.remove('bg-gray-100', 'text-gray-700', 'shadow-sm');
                activeButton.classList.add('active', 'bg-gradient-to-r', 'from-purple-500', 'to-blue-500', 'text-white', 'shadow-md');
            }
            
            displayProducts();
        }

        // Logout function
        function logout() {
            if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
                StorageManager.remove('currentUser');
                currentUser = null;
                document.getElementById('mainPage').classList.add('hidden');
                document.getElementById('authPage').classList.remove('hidden');
                document.getElementById('loginForm').reset();
                document.getElementById('registerForm').reset();
                showLoginForm();
            }
        }

        // Initialize empty products array
        function initializeProducts() {
            // No sample products - start with empty array
            if (!localStorage.getItem('products')) {
                localStorage.setItem('products', JSON.stringify([]));
            }
        }

        // وظائف تفاعلية جديدة
        function createFloatingHearts() {
            const heartsContainer = document.createElement('div');
            heartsContainer.className = 'floating-hearts';
            document.body.appendChild(heartsContainer);
            
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.className = 'heart';
                    heart.innerHTML = '❤️';
                    heart.style.left = Math.random() * 100 + '%';
                    heart.style.top = '100%';
                    heartsContainer.appendChild(heart);
                    
                    setTimeout(() => heart.remove(), 3000);
                }, i * 200);
            }
            
            setTimeout(() => heartsContainer.remove(), 4000);
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            let bgColor = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            let icon = 'ℹ️';
            
            if (type === 'success') {
                bgColor = 'linear-gradient(135deg, #4ade80 0%, #22c55e 100%)';
                icon = '✅';
            } else if (type === 'error') {
                bgColor = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                icon = '❌';
            } else if (type === 'warning') {
                bgColor = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
                icon = '⚠️';
            }
            
            notification.style.background = bgColor;
            notification.innerHTML = `
                <div class="flex items-center gap-3">
                    <div class="text-2xl">${icon}</div>
                    <div>${message}</div>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }
        
        function updateProductCount() {
            const count = products.length;
            document.getElementById('productCount').textContent = count;
            document.getElementById('totalProducts').textContent = count;
            
            // حساب منتجات اليوم
            const today = new Date().toLocaleDateString('ar-SA');
            const todayCount = products.filter(p => p.dateAdded === today).length;
            document.getElementById('todayProducts').textContent = todayCount;
            
            // إظهار شارة "جديد" إذا كان هناك منتجات جديدة
            const newProductBadge = document.getElementById('newProductBadge');
            if (todayCount > 0) {
                newProductBadge.style.display = 'flex';
                setTimeout(() => {
                    newProductBadge.style.display = 'none';
                }, 5000);
            }
        }
        
        function viewProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                product.views = (product.views || 0) + 1;
                StorageManager.set('products', products);
                displayProducts();
                showNotification(`👁️ تم عرض منتج: ${product.name}`);
            }
        }
        
        function toggleFavorite(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                product.favorites = (product.favorites || 0) + 1;
                StorageManager.set('products', products);
                displayProducts();
                createSparkles(event.target);
                showNotification(`❤️ تم إضافة ${product.name} للمفضلة!`);
            }
        }
        
        function createSparkles(element) {
            const rect = element.getBoundingClientRect();
            for (let i = 0; i < 5; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.left = rect.left + Math.random() * rect.width + 'px';
                sparkle.style.top = rect.top + Math.random() * rect.height + 'px';
                document.body.appendChild(sparkle);
                
                setTimeout(() => sparkle.remove(), 1500);
            }
        }
        
        function updateStatistics() {
            updateProductCount();
            
            // محاكاة المستخدمين النشطين
            const activeUsers = Math.floor(Math.random() * 50) + 1;
            document.getElementById('activeUsers').textContent = activeUsers;
        }
        
        // Debounced search function
        let searchTimeout;
        function searchProducts() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
                
                if (searchTerm === '') {
                    displayProducts();
                    return;
                }
                
                const filteredProducts = products.filter(product => 
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.description.toLowerCase().includes(searchTerm) ||
                    product.category.toLowerCase().includes(searchTerm) ||
                    product.seller.toLowerCase().includes(searchTerm)
                );
                
                displayedProducts = filteredProducts;
                currentPage = 0;
                renderProductsPage();
            }, 300);
        }
        
        function sortProducts() {
            const sortBy = document.getElementById('sortSelect').value;
            let sortedProducts = [...products];
            
            switch(sortBy) {
                case 'newest':
                    sortedProducts.sort((a, b) => b.id - a.id);
                    break;
                case 'oldest':
                    sortedProducts.sort((a, b) => a.id - b.id);
                    break;
                case 'price-low':
                    sortedProducts.sort((a, b) => parseFloat(a.price) - parseFloat(b.price));
                    break;
                case 'price-high':
                    sortedProducts.sort((a, b) => parseFloat(b.price) - parseFloat(a.price));
                    break;
                case 'popular':
                    sortedProducts.sort((a, b) => (b.views || 0) - (a.views || 0));
                    break;
                case 'favorites':
                    sortedProducts.sort((a, b) => (b.favorites || 0) - (a.favorites || 0));
                    break;
            }
            
            displayFilteredProducts(sortedProducts);
        }
        
        function displayFilteredProducts(filteredProducts) {
            const grid = document.getElementById('productsGrid');
            const noProducts = document.getElementById('noProducts');
            
            if (filteredProducts.length === 0) {
                grid.classList.add('hidden');
                noProducts.classList.remove('hidden');
                return;
            }
            
            grid.classList.remove('hidden');
            noProducts.classList.add('hidden');
            
            grid.innerHTML = filteredProducts.map(product => {
                const contactMethodsHTML = product.contactMethods.map(contact => {
                    if (contact.type === 'phone') {
                        return `<a href="tel:${contact.value}" class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs hover:bg-blue-200 transition-colors">📞 ${contact.value}</a>`;
                    } else if (contact.type === 'whatsapp') {
                        return `<a href="https://wa.me/${contact.value.replace(/[^0-9]/g, '')}" target="_blank" class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs hover:bg-green-200 transition-colors">💬 واتساب</a>`;
                    } else if (contact.type === 'telegram') {
                        return `<a href="https://t.me/${contact.value}" target="_blank" class="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-xs hover:bg-purple-200 transition-colors">✈️ تليجرام</a>`;
                    }
                    return '';
                }).join('');
                
                return `
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden card-hover" onclick="viewProduct(${product.id})">
                        <div class="relative">
                            ${product.images && product.images.length > 0 ? 
                                `<img src="${product.images[0]}" class="w-full h-48 object-cover" alt="${product.name}">` :
                                `<div class="w-full h-48 bg-gradient-to-br from-purple-100 to-blue-100 flex items-center justify-center">
                                    <span class="text-6xl">📦</span>
                                </div>`
                            }
                            <div class="absolute top-2 right-2 bg-purple-500 text-white px-2 py-1 rounded-full text-xs">
                                ${product.category}
                            </div>
                            ${product.isNew ? '<div class="absolute top-2 left-2 bg-red-500 text-white px-2 py-1 rounded-full text-xs animate-pulse">🔥 جديد</div>' : ''}
                            <div class="absolute bottom-2 left-2 flex gap-1">
                                <button onclick="event.stopPropagation(); toggleFavorite(${product.id})" class="bg-white bg-opacity-80 hover:bg-opacity-100 p-2 rounded-full transition-all">
                                    <span class="text-red-500">❤️</span>
                                </button>
                                <div class="bg-white bg-opacity-80 px-2 py-1 rounded-full text-xs">
                                    👁️ ${product.views || 0}
                                </div>
                            </div>
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-semibold mb-2 text-gray-800">${product.name}</h3>
                            <p class="text-gray-600 mb-3" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">${product.description}</p>
                            <div class="flex items-center justify-between mb-4">
                                <span class="text-2xl font-bold text-green-600">${product.price} ${product.currency || 'ريال'}</span>
                                <span class="text-sm text-gray-500">بواسطة: ${product.seller}</span>
                            </div>
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-2">
                                    <div class="flex text-yellow-400">
                                        ${'★'.repeat(Math.floor(product.rating || 0))}${'☆'.repeat(5 - Math.floor(product.rating || 0))}
                                    </div>
                                    <span class="text-sm text-gray-500">(${product.ratingCount || 0})</span>
                                </div>
                                <div class="flex items-center gap-2 text-sm text-gray-500">
                                    <span>❤️ ${product.favorites || 0}</span>
                                    <span>👁️ ${product.views || 0}</span>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <p class="text-sm text-gray-600 font-medium">طرق التواصل:</p>
                                <div class="flex flex-wrap gap-2">
                                    ${contactMethodsHTML}
                                </div>
                            </div>
                            <div class="mt-4 pt-4 border-t border-gray-200">
                                <span class="text-xs text-gray-500">تاريخ النشر: ${product.dateAdded}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Optimized localStorage operations
        const StorageManager = {
            cache: new Map(),
            
            get(key) {
                if (this.cache.has(key)) {
                    return this.cache.get(key);
                }
                
                try {
                    const value = localStorage.getItem(key);
                    const parsed = value ? JSON.parse(value) : null;
                    this.cache.set(key, parsed);
                    return parsed;
                } catch (e) {
                    console.error('Error reading from localStorage:', e);
                    return null;
                }
            },
            
            set(key, value) {
                try {
                    localStorage.setItem(key, JSON.stringify(value));
                    this.cache.set(key, value);
                } catch (e) {
                    console.error('Error writing to localStorage:', e);
                }
            },
            
            remove(key) {
                localStorage.removeItem(key);
                this.cache.delete(key);
            }
        };

        // Generate dynamic sitemap
        function generateSitemap() {
            const sitemap = {
                "@context": "https://schema.org",
                "@type": "ItemList",
                "name": "ARX-Shop Products",
                "description": "قائمة بجميع المنتجات المتاحة على ARX-Shop",
                "numberOfItems": products.length,
                "itemListElement": products.map((product, index) => ({
                    "@type": "Product",
                    "position": index + 1,
                    "name": product.name,
                    "description": product.description,
                    "category": product.category,
                    "offers": {
                        "@type": "Offer",
                        "price": product.price,
                        "priceCurrency": product.currency === 'ريال' ? 'SAR' : 'AED',
                        "availability": "https://schema.org/InStock",
                        "seller": {
                            "@type": "Person",
                            "name": product.seller
                        }
                    },
                    "aggregateRating": {
                        "@type": "AggregateRating",
                        "ratingValue": product.rating || 0,
                        "reviewCount": product.ratingCount || 0
                    }
                }))
            };
            
            // Update structured data
            const script = document.createElement('script');
            script.type = 'application/ld+json';
            script.textContent = JSON.stringify(sitemap);
            
            // Remove old product schema if exists
            const oldSchema = document.querySelector('script[data-schema="products"]');
            if (oldSchema) oldSchema.remove();
            
            script.setAttribute('data-schema', 'products');
            document.head.appendChild(script);
        }

        // Update page title and meta description dynamically
        function updatePageMeta(section) {
            const titles = {
                welcome: 'ARX-Shop - منصة البيع والشراء الآمن | متجر إلكتروني موثوق',
                about: 'من نحن - ARX-Shop | منصة التجارة الإلكترونية الرائدة',
                sell: 'عرض منتج للبيع - ARX-Shop | ابدأ البيع الآن',
                products: `تصفح المنتجات - ARX-Shop | ${products.length} منتج متاح`
            };
            
            const descriptions = {
                welcome: 'ARX-Shop هي منصة التجارة الإلكترونية الرائدة في المنطقة العربية. بع واشتري بأمان - ملابس، إلكترونيات، أثاث، تجميل وآلاف المنتجات الأخرى.',
                about: 'تعرف على ARX-Shop - منصة التجارة الإلكترونية الموثوقة. رؤيتنا، مهمتنا، وكيف نخدم ملايين المستخدمين في المنطقة العربية.',
                sell: 'ابدأ البيع على ARX-Shop واربح المال. عرض منتجاتك لملايين المشترين. سهل، آمن، ومربح.',
                products: `اكتشف ${products.length} منتج متنوع على ARX-Shop. ملابس، إلكترونيات، أثاث، تجميل وأكثر بأفضل الأسعار.`
            };
            
            document.title = titles[section] || titles.welcome;
            
            const metaDesc = document.querySelector('meta[name="description"]');
            if (metaDesc) {
                metaDesc.setAttribute('content', descriptions[section] || descriptions.welcome);
            }
            
            // Update Open Graph tags
            const ogTitle = document.querySelector('meta[property="og:title"]');
            const ogDesc = document.querySelector('meta[property="og:description"]');
            
            if (ogTitle) ogTitle.setAttribute('content', titles[section] || titles.welcome);
            if (ogDesc) ogDesc.setAttribute('content', descriptions[section] || descriptions.welcome);
        }

        // Check if user is already logged in
        window.addEventListener('load', function() {
            // Initialize accessibility features
            initializeAccessibility();
            
            // Load data from optimized storage
            products = StorageManager.get('products') || [];
            users = StorageManager.get('users') || [];
            
            updateStatistics();
            generateSitemap();
            
            const savedUser = StorageManager.get('currentUser');
            if (savedUser) {
                currentUser = savedUser;
                document.getElementById('authPage').classList.add('hidden');
                document.getElementById('mainPage').classList.remove('hidden');
                document.getElementById('welcomeUser').textContent = `مرحباً، ${currentUser.name}`;
                showWelcome();
                announceToScreenReader(`مرحباً ${currentUser.name}، تم تسجيل دخولك بنجاح`);
            } else {
                // Focus on first form field for better accessibility
                setTimeout(() => {
                    document.getElementById('loginEmail').focus();
                }, 500);
            }
            
            // تحديث الإحصائيات كل 30 ثانية
            setInterval(updateStatistics, 30000);
            
            // تحديث خريطة الموقع كل دقيقة
            setInterval(generateSitemap, 60000);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96a69651c425e4a9',t:'MTc1NDM5OTk3Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
<script>
async function handleImageUpload(event) {
    const files = event.target.files;
    const previewContainer = document.getElementById('imagePreview');
    previewContainer.innerHTML = '';
    window.uploadedProductImages = [];

    for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const fileName = `${Date.now()}_${file.name}`;

        const { data, error } = await supabase
            .storage
            .from('product-images')
            .upload(fileName, file);

        if (error) {
            console.error('❌ فشل في رفع الصورة:', error.message);
            showNotification('❌ فشل في رفع الصورة: ' + error.message, 'error');
            continue;
        }

        const { data: publicUrlData } = supabase
            .storage
            .from('product-images')
            .getPublicUrl(fileName);

        const imageUrl = publicUrlData.publicUrl;

        const img = document.createElement('img');
        img.src = imageUrl;
        img.alt = 'صورة المنتج';
        img.className = 'w-full h-32 object-cover rounded-lg border';
        previewContainer.appendChild(img);

        window.uploadedProductImages.push(imageUrl);
    }
}
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const auth = window.firebase.auth;
  const db = window.firebase.db;
  const storage = window.firebase.storage;

  const { createUserWithEmailAndPassword, signInWithEmailAndPassword, collection, addDoc, ref, uploadBytes, getDownloadURL } = window.firebase;

  // تسجيل حساب جديد
  document.getElementById('registerForm')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('registerName').value;
    const countryCode = document.getElementById('registerCountryCode').value;
    const phone = document.getElementById('registerPhone').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;
      window.currentUser = user;
      await addDoc(collection(db, "users"), {
        uid: user.uid,
        name,
        phone: countryCode + phone,
        email,
        createdAt: new Date().toISOString()
      });
      showNotification("✅ تم إنشاء الحساب بنجاح", "success");
      showLoginForm();
    } catch (error) {
      showNotification("❌ فشل في إنشاء الحساب: " + error.message, "error");
    }
  });

  // تسجيل الدخول
  document.getElementById('loginForm')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;

    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;
      window.currentUser = user;
      document.getElementById('authPage')?.classList.add('hidden');
      document.getElementById('mainPage')?.classList.remove('hidden');
      document.getElementById('welcomeUser').textContent = user.email;
      showNotification("✅ تم تسجيل الدخول", "success");
      loadProducts();
    } catch (error) {
      showNotification("❌ فشل تسجيل الدخول: " + error.message, "error");
    }
  });

  // رفع منتج جديد
  document.getElementById('sellForm')?.addEventListener('submit', async (e) => {
    e.preventDefault();
    const name = document.getElementById('productName').value;
    const category = document.getElementById('productCategory').value;
    const description = document.getElementById('productDescription').value;
    const price = parseFloat(document.getElementById('productPrice').value);
    const currency = document.getElementById('productCurrency').value;
    const images = document.getElementById('productImages').files;

    let imageUrls = [];
    for (let file of images) {
      const imageRef = ref(storage, 'products/' + Date.now() + '-' + file.name);
      await uploadBytes(imageRef, file);
      const url = await getDownloadURL(imageRef);
      imageUrls.push(url);
    }

    const contact = {
      phone: document.getElementById('contactPhone')?.checked ? document.getElementById('contactPhoneNumber').value : "",
      whatsapp: document.getElementById('contactWhatsapp')?.checked ? document.getElementById('contactWhatsappNumber').value : "",
      telegram: document.getElementById('contactTelegram')?.checked ? document.getElementById('contactTelegramUsername').value : "",
    };

    await addDoc(collection(db, "products"), {
      name, category, description, price, currency, images: imageUrls, contact,
      createdAt: new Date().toISOString(),
      user: window.currentUser?.email || "unknown"
    });

    showNotification("✅ تم نشر المنتج بنجاح", "success");
    document.getElementById('sellForm').reset();
    showWelcome();
  });

  // تحميل المنتجات
  window.loadProducts = async function () {
    const db = window.firebase.db;
    const productsGrid = document.getElementById('productsGrid');
    if (!productsGrid) return;
    productsGrid.innerHTML = '';
    const q = window.firebase.query(collection(db, "products"), window.firebase.orderBy("createdAt", "desc"));
    const snapshot = await window.firebase.getDocs(q);
    let count = 0;
    snapshot.forEach(doc => {
      const product = doc.data();
      const div = document.createElement("div");
      div.className = "bg-white p-4 rounded-lg shadow-lg";
div.innerHTML = `
  <img src="${product.images?.[0] || ''}" alt="صورة المنتج" class="w-full h-48 object-cover rounded-lg mb-4">
  <h3 class="text-lg font-bold mb-1">${product.name}</h3>
  <p class="text-sm text-gray-600 mb-1">${product.description}</p>
  <div class="text-green-600 font-semibold">${product.price} ${product.currency}</div>
`;
productsGrid.appendChild(div);
count++;
});
document.getElementById('productCount').textContent = count;
document.getElementById('totalProducts').textContent = count;
document.getElementById('todayProducts').textContent = count;
};
});
</script>

</body>
</html>
